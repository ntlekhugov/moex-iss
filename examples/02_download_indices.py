#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
–ü—Ä–∏–º–µ—Ä 2: –ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤
====================================

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∫–∞–∫ —Å–∫–∞—á–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–æ –∏–Ω–¥–µ–∫—Å–æ–≤:
1. –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –æ–±–ª–∏–≥–∞—Ü–∏–π
2. –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ç–æ—Ä–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∞–∫—Ü–∏–π
3. –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ø–∏—Å–∫–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤

–ó–∞–ø—É—Å–∫:
    python examples/02_download_indices.py
"""

import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º –ø—É—Ç—å –∫ –ø–∞–∫–µ—Ç—É
sys.path.insert(0, str(Path(__file__).parent.parent))

from moex_iss import (
    download_bond_indices,
    download_equity_indices,
    BOND_INDICES,
    EQUITY_INDICES,
)
from moex_iss.indices import list_indices


def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ—Ä–∞."""

    print("=" * 60)
    print("MOEX ISS API ‚Äî –ü–∞–∫–µ—Ç–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤")
    print("=" * 60)

    # =========================================================
    # –®–∞–≥ 1: –ü—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
    # =========================================================
    print("\nüìå –®–∞–≥ 1: –î–æ—Å—Ç—É–ø–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã")
    print("-" * 40)

    # –ò–Ω–¥–µ–∫—Å—ã –æ–±–ª–∏–≥–∞—Ü–∏–π
    print(f"\nüìä –ò–Ω–¥–µ–∫—Å—ã –æ–±–ª–∏–≥–∞—Ü–∏–π: {len(BOND_INDICES)} —à—Ç.")
    print("   –ü—Ä–∏–º–µ—Ä—ã:")
    for code, info in list(BOND_INDICES.items())[:5]:
        print(f"      {code:15} ‚Äî {info['name_ru']}")
    print(f"      ... –∏ –µ—â—ë {len(BOND_INDICES) - 5} –∏–Ω–¥–µ–∫—Å–æ–≤")

    # –ò–Ω–¥–µ–∫—Å—ã –∞–∫—Ü–∏–π
    print(f"\nüìà –ò–Ω–¥–µ–∫—Å—ã –∞–∫—Ü–∏–π: {len(EQUITY_INDICES)} —à—Ç.")
    print("   –ü—Ä–∏–º–µ—Ä—ã:")
    for code, info in list(EQUITY_INDICES.items())[:5]:
        print(f"      {code:15} ‚Äî {info['name_ru']}")
    print(f"      ... –∏ –µ—â—ë {len(EQUITY_INDICES) - 5} –∏–Ω–¥–µ–∫—Å–æ–≤")

    # =========================================================
    # –®–∞–≥ 2: –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –∞–∫—Ü–∏–π
    # =========================================================
    print("\nüìå –®–∞–≥ 2: –ó–∞–≥—Ä—É–∑–∫–∞ —Å–µ–∫—Ç–æ—Ä–Ω—ã—Ö –∏–Ω–¥–µ–∫—Å–æ–≤ –∞–∫—Ü–∏–π")
    print("-" * 40)

    # –í—ã–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã
    sector_indices = ['MOEXOG', 'MOEXFN', 'MOEXMM', 'MOEXIT']
    print(f"\n–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã: {', '.join(sector_indices)}")

    results = download_equity_indices(
        indices=sector_indices,
        output_dir='./data/equity_sectors',
        start_date='2024-01-01'
    )

    # –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
    print("\n–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:")
    for code, success in results.items():
        status = "‚úÖ" if success else "‚ùå"
        print(f"   {status} {code}")

    # =========================================================
    # –®–∞–≥ 3: –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–Ω–¥–µ–∫—Å–æ–≤ –æ–±–ª–∏–≥–∞—Ü–∏–π
    # =========================================================
    print("\nüìå –®–∞–≥ 3: –ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–¥–µ–∫—Å–æ–≤ –æ–±–ª–∏–≥–∞—Ü–∏–π")
    print("-" * 40)

    # –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –æ–±–ª–∏–≥–∞—Ü–∏–π
    bond_indices = ['RGBITR', 'RUCBTRNS', 'RUCBHYTR']
    print(f"\n–ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω–¥–µ–∫—Å—ã: {', '.join(bond_indices)}")

    results = download_bond_indices(
        indices=bond_indices,
        output_dir='./data/bonds',
        start_date='2024-01-01'
    )

    print("\n–†–µ–∑—É–ª—å—Ç–∞—Ç—ã:")
    for code, success in results.items():
        status = "‚úÖ" if success else "‚ùå"
        print(f"   {status} {code}")

    # =========================================================
    # –®–∞–≥ 4: –ü–æ–ª—É—á–∞–µ–º —Ç–∞–±–ª–∏—Ü—É –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤
    # =========================================================
    print("\nüìå –®–∞–≥ 4: –¢–∞–±–ª–∏—Ü–∞ –≤—Å–µ—Ö –∏–Ω–¥–µ–∫—Å–æ–≤")
    print("-" * 40)

    df = list_indices('all')
    print(f"\n–í—Å–µ–≥–æ –∏–Ω–¥–µ–∫—Å–æ–≤ –≤ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–µ: {len(df)}")
    print("\n–ü–µ—Ä–≤—ã–µ 10:")
    print(df[['code', 'name_ru', 'category']].head(10).to_string(index=False))

    # =========================================================
    # –ì–æ—Ç–æ–≤–æ!
    # =========================================================
    print("\n" + "=" * 60)
    print("–ü—Ä–∏–º–µ—Ä –∑–∞–≤–µ—Ä—à—ë–Ω!")
    print("–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö ./data/equity_sectors –∏ ./data/bonds")
    print("=" * 60)


if __name__ == "__main__":
    main()
